# Pre-commit hooks for mlTrainer governance enforcement
# These hooks run BEFORE any code can be committed to the repository

repos:
  # Check for synthetic data patterns
  - repo: local
    hooks:
      - id: check-synthetic-data
        name: Check for synthetic data
        entry: python hooks/check_synthetic_data.py
        language: python
        files: \.(py|ipynb)$
        fail_fast: true
        verbose: true

  # Validate governance compliance
  - repo: local
    hooks:
      - id: validate-governance
        name: Validate governance compliance
        entry: python hooks/validate_governance.py
        language: python
        files: \.py$
        fail_fast: true
        verbose: true

  # Check for hardcoded secrets
  - repo: local
    hooks:
      - id: check-secrets
        name: Check for hardcoded secrets
        entry: python hooks/check_secrets.py
        language: python
        files: \.(py|yaml|yml|json|env)$
        fail_fast: true

  # Ensure governance imports
  - repo: local
    hooks:
      - id: check-governance-imports
        name: Check governance imports
        entry: python hooks/check_governance_imports.py
        language: python
        files: ^(core|utils|backend)/.*\.py$
        exclude: ^core/governance.*\.py$

  # Standard security checks
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        args: ['-r', '.', '-f', 'json', '-o', 'bandit-report.json']
        exclude: tests/

  # Check for common security issues
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: package-lock.json

  # Python code quality
  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        language_version: python3.11

  # Import sorting
  - repo: https://github.com/PyCQA/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ["--profile", "black"]

  # Type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.3.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
        args: [--strict]

# Configuration
default_language_version:
  python: python3.11

fail_fast: true  # Stop on first failure
minimum_pre_commit_version: 3.0.0